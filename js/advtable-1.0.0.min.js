(function(d,I,J,K){function q(r,n){this.element=r;this.options=d.extend({},u,n);this._defaults=u;this._name=l;this.init()}navigator.userAgent.indexOf("Safari");var p=-1!=navigator.userAgent.indexOf("MSIE"),v=-1!=navigator.userAgent.indexOf("Firefox"),l="advTable",u={src:"database",name:"advTable",width:1E3,height:300,delimiter:";",buttons:{addRow:!0,dellRow:!0,update:!0,reload:!0,search:!0},php:{id:0,file:"com.php",user:"root",timeout:6E4}};q.prototype={init:function(){function r(a,L){for(var c="<tbody>",
b="<thead><tr>",e=0;e<a.length;e++)c+="<tr>",d.each(a[e],function(a,d){0==e?b+="<th>"+a+"</th>":null;"object"==typeof d&&null!=d?c+="<td>"+d.date+"</td>":c+="<td>"+d+"</td>"}),c+="</tr>";b+="</thead>";c+="</tbody>";return{th:b,tb:c}}function n(){var a=d('<div style = "width:100px;height:100px;overflow:hidden">'),c=d('<div style = "width:100%;height:100%">');a.appendTo(d("body"));a.append(c);var b=c.width();a.css("overflow","scroll");c=c.width();a.remove();return b-c}function l(){rows=c.children("tbody").find("tr");
var a=rows.length;rows.addClass("hide");c.children("tbody").find("td").filter(function(a){return-1!=d(this).html().toLocaleLowerCase().indexOf(s.val().toLocaleLowerCase())}).parent("tr").removeClass("hide");var b=rows.parent().find(".hide").length;G.html("Total rows - Filtered rows: "+a.toString()+" - "+(a-b).toString());h.co=a/(a-b);h.act=0;h.set()}function B(a){var c=[];d.each(a.children("td"),function(){c.push(d(this).html())});return c}var c=d(this.element);if(0==c.children().length&&"database"==
this.options.src){var g=this.options,b=c.advTable.ajaxcall(g.php.file,g.name,g.php.id,"load",g.php.user,""),g=r(b,g),t=d(g.th),g=d(g.tb);c.append(t).append(g)}else 0==c.children().length&&"database"!=this.options.src&&(g=this.options,b=c.advTable.ajaxcall(g.php.file,g.name,g.php.id,"load_excel",g.src,g.delimiter),c.html(b));b='<div class="outertbl" tabindex="0"><div class="tblwrp"><div class="hdwrp" style="width: 983px;"></div>\t\t<div class="bdwrp">\t\t\t<img src="css/img/resize.png" class="resize"><img src="css/img/down.png" class="down" title = "down">';
b+='\t\t\t<img src="css/img/up.png" class="up" title = "up"><img src="css/img/option.png" class="option" title = "console">';b+='\t\t\t<a href = "upload/'+this.options.name+'.csv" class="download" title = "download"><img style = "height: 100%;" src="css/img/download.png" ></a>';b+="\t\t</div>";b+="\t</div>";b+='\t<div class="consol" >';b+='\t\t<a style="font-weight: bold;">advTable</a><br><br>';b+='\t\t<input type="button" class="cButton" value="reload">';b+='\t\t<input type="button" class="cButton" value="update">';
b+='\t\t<input type="button" class="cButton" value="add row">';b+='\t\t<input type="button" class="cButton" value="del row">';b+='\t\t<a>Search : </a><input type="text" class="cInput" tabindex="1"><br>';b+="\t\t<a>Total rows - Filtered rows: 0 - 0</a>";b+='\t\t<div class = "loaderDiv"><a></a><div class = "bar"></div></div>';b+="\t</div>";b+="</div>";g=c.children("thead");c.children("tbody");var A=[],w=d('<table class = "tbldef"><thead><tr></tr></thead></table>'),e=d(b),x=e.find(".tblwrp"),y=e.find(".hdwrp"),
f=e.find(".bdwrp");e.find(".resize");var b=e.find(".option"),q=e.find(".down"),u=e.find(".download"),H=e.find(".up"),m=e.find(".consol"),C=m.children("input").eq(0);!0==this.options.buttons.reload?null:C.css("display","none");var D=m.children("input").eq(1);!0==this.options.buttons.update?null:D.css("display","none");var E=m.children("input").eq(2);!0==this.options.buttons.addRow?null:E.css("display","none");var F=m.children("input").eq(3);!0==this.options.buttons.dellRow?null:F.css("display","none");
var s=m.children("input").eq(4);!0==this.options.buttons.search?null:s.css("display","none");var G=m.children("a").eq(2);m.children("a").eq(0).html(this.options.name);var k="",z=[],h=e.find(".bar");h.per=function(){return this.parent().width()/this.co};h.co=0;h.act=0;h.set=function(){this.act+=this.per();this.width(this.act);this.parent().children("a").html((100*(this.act/this.parent().width())).toFixed(2)+" %");return 100*(this.act/this.parent().width())};f.height(this.options.height);x.width(this.options.width);
e.insertBefore(c);c.appendTo(f).addClass("tbldef");d.each(g.children("tr").eq(0).children("th"),function(a){A.push(d(this).outerWidth(!0));t=d("<th>");t.html('<div style = "min-width:'+A[a]+'px;">'+d(this).html()+"</div>");w.children("thead").children("tr").append(t);d(this).html('<div style = "min-width:'+A[a]+'px;"></div>')});x.css("max-width",c.outerWidth(!0)+n());y.append(w);y.width(f.width()-n());e.data().resize={};e.data().resize.state=!1;e.data().resize.x=0;e.data().resize.y=0;c.css({top:-c.children("thead").outerHeight(!0)});
f.on({scroll:function(){var a=f.scrollLeft();y.scrollLeft(a);a=0;p||v?a=f[0].scrollHeight:a=f[0].scrollHeight-f.height();f.scrollTop()>a&&f.scrollTop(a)}});D.on("click",function(){var a=c.data().plugin_advTable.options;if(""==k&&(k=prompt("Please give your password ..."),setTimeout(function(){k=""},c.data().plugin_advTable.options.php.timeout),"OK"!=d.fn.advTable.ajaxcall(a.php.file,a.name,a.php.id,"getpass",!1,k).state)){k="";alert("Error: Wrong Password!");return}if(""!=k){h.width(0);var b=c.find(".updated"),
e=c.find(".newRow"),f=z.toString(),f=f.split(",");h.co=b.length+f.length+e.length;h.width(0);h.act=0;d.each(f,function(c){upRow=f[c];d.fn.advTable.ajaxcall(a.php.file,a.name,a.php.id,"delete",upRow,k,!0,h);z.shift(1)});d.each(e,function(c){upRow=B(e.eq(c));d.fn.advTable.ajaxcall(a.php.file,a.name,a.php.id,"insert",upRow,k,!0,h);e.eq(c).removeClass()});d.each(b,function(c){upRow=B(b.eq(c));d.fn.advTable.ajaxcall(a.php.file,a.name,a.php.id,"update",upRow,k,!0,h);b.eq(c).removeClass()})}});s.click(function(){s.focus()});
b.on("click",function(){"block"==m.css("display")?m.fadeOut(200):m.fadeIn(200,function(){l()})});q.on("click",function(){var a=0;p?a=f[0].scrollHeight:a=f[0].scrollHeight-f.height();f.animate({scrollTop:a},"swing")});H.on("click",function(){f.animate({scrollTop:0},"swing")});c.on({dblclick:function(){if(d(this).index()!=c.data().plugin_advTable.options.php.id&&-1==d(this).html().indexOf("<input")){d(this).css({padding:0,margin:0});var a=1;0==d(this).html().length?a=1:a=d(this).html().length;var b=
0;p||v?b=d(this).outerWidth(!0)-8:b=d(this).outerWidth(!0)-4;d(this).html('<input tabindex="1" size = "'+a+'" type ="text" value = "'+d(this).html()+'" style = "width:'+b+'px;" >');d(this).children("input").focus()}}},"td");c.on({focusout:function(){var a=d(this).parent("td");d(this).attr("tabindex",-1);a.attr("style","");a.parent("tr").addClass("updated");a.html(d(this).val());if(!1!=a.is("td")){var b=a.index(),a=c.children("thead").children("tr").children("th").eq(b),b=w.children("thead").children("tr").children("th").eq(b);
a.children("div").width("100%");a.children("div").width(a.width());a.width()!=b.width()&&(a.children("div").width(a.width()),b.children("div").width(a.width()));x.css("max-width",c.outerWidth(!0)+n())}}},"input");c.on({click:function(a){a.ctrlKey||c.children("tbody").children("tr").removeClass("sel");"undefined"==typeof d(this).attr("class")||-1==d(this).attr("class").indexOf("sel")?d(this).addClass("sel"):d(this).removeClass("sel")}},"tr");F.on("click",function(){var a=c.find(".sel");d.each(a,function(b){z.push(a.eq(b).children("td").eq(c.data().plugin_advTable.options.php.id).html())});
c.find(".sel").animate({"line-height":0,height:0},"swing",function(){d(this).remove()})});e.on({mousedown:function(a){a.preventDefault();v||p?c.css("display","none"):null;e.data().resize.state=!0;e.data().resize.x=a.offsetX||a.originalEvent.layerX;e.data().resize.y=a.offsetY||a.originalEvent.layerY}},".resize");e.parent().on({mousemove:function(a){a.preventDefault();var c=e.data().resize;!0==c.state&&(x.width(a.pageX-e.offset().left-c.x-f.position().left),y.width(f.width()-n()),f.height(a.pageY-
e.offset().top-c.y-f.position().top))},mouseup:function(){v||p?c.css("display","table"):null;e.data().resize.state=!1}});E.on("click",function(){var a=c.children("tbody").children("tr").eq(0).clone(!0);d.each(a.children("td"),function(){d(this).html("?")});c.children("tbody").append(a);a.removeClass();a.addClass("newRow");f.animate({scrollTop:a.position().top-f.height()+a.height()},"swing")});s.on("keyup",l);C.on("click",function(){z=[];var a=c.css("top");f.animate({scrollTop:0},"swing",function(){c.animate({top:f.height()+
50},"swing",function(){var b=c.data().plugin_advTable.options,e=c.advTable.ajaxcall(b.php.file,b.name,b.php.id,"load",b.php.user,k),b=d(r(e,b).tb);c.children("tbody").remove();c.append(b).delay(500).animate({top:a},"swing",function(){s.trigger("keyup")})})})});u.on("click",function(){var a="",b="",e=c.data().plugin_advTable.options;d.each(w.children("thead").children("tr").children("th").children("div"),function(b){a=0==b?a+d(this).html():a+(e.delimiter+d(this).html())});a+="\n";d.each(c.children("tbody").children("tr"),
function(){var a=d(this);if("undefined"==typeof a.attr("class")||-1==a.attr("class").indexOf("hide"))d.each(a.children("td"),function(a){b=0==a?b+d(this).html():b+(e.delimiter+d(this).html())}),b+="\n"});c.advTable.ajaxcall(e.php.file,e.name,e.php.id,"download",a+b,k)})},ajaxTable:function(){return d.fn.advTable.ajaxcall(this.options.php.file,this.options.name,this.options.php.id,"reload",this.options.php.user,password)}};d.fn[l]=function(r){return this.each(function(){d.data(this,"plugin_"+l)||d.data(this,
"plugin_"+l,new q(this,r))})};d.fn[l].ajaxcall=function(l,n,p,q,c,g,b,t){"undefined"==typeof b?b=!1:null;retVal="";d.ajax({url:l,type:"POST",dataType:"xml/html/script/json/jsonp",async:b,data:{id:p,name:n,order:q,param:c,pass:g},complete:function(c,g,e){b&&t.set();retVal=d.parseJSON(c.responseText)||c},success:function(b,c,d){},error:function(b,c,d){}});return retVal}})(jQuery,window,document);