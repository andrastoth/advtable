(function(c,J,K,L){function q(t,k){this.element=t;this.options=c.extend({},u,k);this._defaults=u;this._name=l;this.init()}navigator.userAgent.toLowerCase().indexOf("safari");var k=-1!=navigator.userAgent.toLowerCase().indexOf("msie"),p=-1!=navigator.userAgent.toLowerCase().indexOf("firefox");/android|iphone|ipad/i.test(navigator.userAgent.toLowerCase());var l="advTable",u={src:"database",name:"advTable",width:1E3,height:300,delimiter:";",datePicker:!0,buttons:{addRow:!0,dellRow:!0,update:!0,reload:!0,
search:!0},php:{id:0,file:"com.php",user:"root",timeout:6E4}};q.prototype={init:function(){function t(a){if(/[a-zA-z]/g.test(a))return!1;a=a.replace(/[\-|\.|_]/g,"/");var c=new Date(Date.parse(a));a=a.split("/");if(3>a.length)return!1;var d,b,e;4==a[2].length?(d=2,b=0,e=1):(d=0,b=1,e=2);return c.getMonth()==parseInt(a[b])-1&&c.getDate()==parseInt(a[e])&&c.getFullYear()==parseInt(a[d])}function l(a,M){for(var d="<tbody>",b="<thead><tr>",e=0;e<a.length;e++)d+="<tr>",c.each(a[e],function(a,c){0==e?b+=
"<th>"+a+"</th>":null;"object"==typeof c&&null!=c?d+="<td>"+c.date+"</td>":d+="<td>"+c+"</td>"}),d+="</tr>";b+="</thead>";d+="</tbody>";return{th:b,tb:d}}function r(){var a=c('<div style = "width:100px;height:100px;overflow:hidden">'),d=c('<div style = "width:100%;height:100%">');a.appendTo(c("body"));a.append(d);var b=d.width();a.css("overflow","scroll");d=d.width();a.remove();return b-d}function B(){rows=d.children("tbody").find("tr");var a=rows.length;rows.addClass("hide");d.children("tbody").find("td").filter(function(a){return-1!=
c(this).html().toLocaleLowerCase().indexOf(s.val().toLocaleLowerCase())}).parent("tr").removeClass("hide");var b=rows.parent().find(".hide").length;H.html("Total rows - Filtered rows: "+a.toString()+" - "+(a-b).toString());h.co=a/(a-b);h.act=0;h.set()}function C(a){var d=[];c.each(a.children("td"),function(){d.push(c(this).html())});return d}var d=c(this.element);d.attr("tabindex",0);if(0==d.children().length&&"database"==this.options.src){var f=this.options,b=d.advTable.ajaxcall(f.php.file,f.name,
f.php.id,"load",f.php.user,""),f=l(b,f),v=c(f.th),f=c(f.tb);d.append(v).append(f)}else 0==d.children().length&&"database"!=this.options.src&&(f=this.options,b=d.advTable.ajaxcall(f.php.file,f.name,f.php.id,"load_excel",f.src,f.delimiter),d.html(b));b='<div class="outertbl" tabindex="0"><div class="tblwrp"><div class="hdwrp" style="width: 983px;"></div>\t\t<div class="bdwrp">\t\t\t<img src="css/img/resize.png" class="resize"><img src="css/img/down.png" class="down" title = "down">';b+='\t\t\t<img src="css/img/up.png" class="up" title = "up"><img src="css/img/option.png" class="option" title = "console">';
b+='\t\t\t<a href = "upload/'+this.options.name+'.csv" class="download" title = "download"><img style = "height: 100%;" src="css/img/download.png" ></a>';b+="\t\t</div>";b+="\t</div>";b+='\t<div class="consol" >';b+='\t\t<a style="font-weight: bold;">advTable</a><br><br>';b+='\t\t<input type="button" class="cButton" value="reload">';b+='\t\t<input type="button" class="cButton" value="update">';b+='\t\t<input type="button" class="cButton" value="add row">';b+='\t\t<input type="button" class="cButton" value="del row">';
b+='\t\t<a>Search : </a><input type="text" class="cInput" tabindex="1"><br>';b+="\t\t<a>Total rows - Filtered rows: 0 - 0</a>";b+='\t\t<div class = "loaderDiv"><a></a><div class = "bar"></div></div>';b+="\t</div>";b+="</div>";f=d.children("thead");d.children("tbody");var A=[],w=c('<table class = "tbldef"><thead><tr></tr></thead></table>'),e=c(b),x=e.find(".tblwrp"),y=e.find(".hdwrp"),g=e.find(".bdwrp");e.find(".resize");var b=e.find(".option"),q=e.find(".down"),u=e.find(".download"),I=e.find(".up"),
n=e.find(".consol"),D=n.children("input").eq(0);!0==this.options.buttons.reload?null:D.css("display","none");var E=n.children("input").eq(1);!0==this.options.buttons.update?null:E.css("display","none");var F=n.children("input").eq(2);!0==this.options.buttons.addRow?null:F.css("display","none");var G=n.children("input").eq(3);!0==this.options.buttons.dellRow?null:G.css("display","none");var s=n.children("input").eq(4);!0==this.options.buttons.search?null:s.css("display","none");var H=n.children("a").eq(2);
n.children("a").eq(0).html(this.options.name);var m="",z=[],h=e.find(".bar");h.per=function(){return this.parent().width()/this.co};h.co=0;h.act=0;h.set=function(){this.act+=this.per();this.width(this.act);this.parent().children("a").html((100*(this.act/this.parent().width())).toFixed(2)+" %");return 100*(this.act/this.parent().width())};g.height(this.options.height);x.width(this.options.width);e.insertBefore(d);d.appendTo(g).addClass("tbldef");c.each(f.children("tr").eq(0).children("th"),function(a){A.push(c(this).outerWidth(!0));
v=c("<th>");v.html('<div style = "min-width:'+A[a]+'px;">'+c(this).html()+"</div>");w.children("thead").children("tr").append(v);c(this).html('<div style = "min-width:'+A[a]+'px;"></div>')});x.css("max-width",d.outerWidth(!0)+r());y.append(w);y.width(g.width()-r());e.data().resize={};e.data().resize.state=!1;e.data().resize.x=0;e.data().resize.y=0;d.css({top:-d.children("thead").outerHeight(!0)});g.on({scroll:function(){var a=g.scrollLeft();y.scrollLeft(a);a=0;k||p?a=g[0].scrollHeight:a=g[0].scrollHeight-
g.height();g.scrollTop()>a&&g.scrollTop(a)}});E.on("click",function(){var a=d.data().plugin_advTable.options;if(""==m&&(m=prompt("Please give your password ..."),setTimeout(function(){m=""},d.data().plugin_advTable.options.php.timeout),"OK"!=c.fn.advTable.ajaxcall(a.php.file,a.name,a.php.id,"getpass",!1,m).state)){m="";alert("Error: Wrong Password!");return}if(""!=m){h.width(0);var b=d.find(".updated"),e=d.find(".newRow"),f=z.toString(),f=f.split(",");h.co=b.length+f.length+e.length;h.width(0);h.act=
0;c.each(f,function(d){upRow=f[d];c.fn.advTable.ajaxcall(a.php.file,a.name,a.php.id,"delete",upRow,m,!0,h);z.shift(1)});c.each(e,function(d){upRow=C(e.eq(d));c.fn.advTable.ajaxcall(a.php.file,a.name,a.php.id,"insert",upRow,m,!0,h);e.eq(d).removeClass()});c.each(b,function(d){upRow=C(b.eq(d));c.fn.advTable.ajaxcall(a.php.file,a.name,a.php.id,"update",upRow,m,!0,h);b.eq(d).removeClass()})}});s.click(function(){s.focus()});b.on("click",function(){"block"==n.css("display")?n.fadeOut(200):n.fadeIn(200,
function(){B()})});q.on("click",function(){var a=0;k?a=g[0].scrollHeight:a=g[0].scrollHeight-g.height();g.animate({scrollTop:a},"swing")});I.on("click",function(){g.animate({scrollTop:0},"swing")});d.on({dblclick:function(){var a=d.data().plugin_advTable.options;if(c(this).index()!=a.php.id&&-1==c(this).html().indexOf("<input")){c(this).css({padding:0,margin:0});var b=1,e="text",f=c(this).html();a.datePicker&&t(c(this).html())&&(10<c(this).html().length?e="datetime-local":e="date",f=c(this).html().replace(" ",
"T"));0==c(this).html().length?b=1:b=c(this).html().length;a=0;k||p?a=c(this).outerWidth(!0)-8:a=c(this).outerWidth(!0)-4;k||p?oh=c(this).outerHeight(!0)-8:oh=c(this).outerHeight(!0)-4;c(this).html('<input tabindex="1" size = "'+b+'" type ="'+e+'" value = "'+f+'" style = "width:'+a+"px;height:"+oh+'px" >');c(this).children("input").focus()}}},"td");d.on({focusout:function(){var a=c(this).parent("td"),b=c(this).val();t(b.replace("T"," "))?b=b.replace("T"," "):b;c(this).attr("tabindex",-1);a.attr("style",
"");a.parent("tr").addClass("updated");a.html(b);!1!=a.is("td")&&(b=a.index(),a=d.children("thead").children("tr").children("th").eq(b),b=w.children("thead").children("tr").children("th").eq(b),a.children("div").width("auto"),a.children("div").width(a.width()),a.width()!=b.width()&&(a.children("div").width(a.width()),b.children("div").width(a.width())),x.css("max-width",d.outerWidth(!0)+r()))}},"input");d.on({click:function(a){a.ctrlKey||d.children("tbody").children("tr").removeClass("sel");"undefined"==
typeof c(this).attr("class")||-1==c(this).attr("class").indexOf("sel")?c(this).addClass("sel"):c(this).removeClass("sel")}},"tr");G.on("click",function(){var a=d.find(".sel");c.each(a,function(c){z.push(a.eq(c).children("td").eq(d.data().plugin_advTable.options.php.id).html())});d.find(".sel").animate({"line-height":0,height:0},"swing",function(){c(this).remove()})});e.on({mousedown:function(a){a.preventDefault();p||k?d.css("display","none"):null;e.data().resize.state=!0;e.data().resize.x=a.offsetX||
a.originalEvent.layerX;e.data().resize.y=a.offsetY||a.originalEvent.layerY}},".resize");e.parent().on({mousemove:function(a){a.preventDefault();var c=e.data().resize;!0==c.state&&(x.width(a.pageX-e.offset().left-c.x-g.position().left),y.width(g.width()-r()),g.height(a.pageY-e.offset().top-c.y-g.position().top))},mouseup:function(){p||k?d.css("display","table"):null;e.data().resize.state=!1}});F.on("click",function(){var a=d.children("tbody").children("tr").eq(0).clone(!0);c.each(a.children("td"),
function(){c(this).html("?")});d.children("tbody").append(a);a.removeClass();a.addClass("newRow");g.animate({scrollTop:a.position().top-g.height()+a.height()},"swing")});s.on("keyup",B);D.on("click",function(){z=[];var a=d.css("top");g.animate({scrollTop:0},"swing",function(){d.animate({top:g.height()+50},"swing",function(){var b=d.data().plugin_advTable.options,e=d.advTable.ajaxcall(b.php.file,b.name,b.php.id,"load",b.php.user,m),b=c(l(e,b).tb);d.children("tbody").remove();d.append(b).delay(500).animate({top:a},
"swing",function(){s.trigger("keyup")})})})});u.on("click",function(){var a="",b="",e=d.data().plugin_advTable.options;c.each(w.children("thead").children("tr").children("th").children("div"),function(b){a=0==b?a+c(this).html():a+(e.delimiter+c(this).html())});a+="\n";c.each(d.children("tbody").children("tr"),function(){var a=c(this);if("undefined"==typeof a.attr("class")||-1==a.attr("class").indexOf("hide"))c.each(a.children("td"),function(a){b=0==a?b+c(this).html():b+(e.delimiter+c(this).html())}),
b+="\n"});d.advTable.ajaxcall(e.php.file,e.name,e.php.id,"download",a+b,m)})},ajaxTable:function(){return c.fn.advTable.ajaxcall(this.options.php.file,this.options.name,this.options.php.id,"reload",this.options.php.user,password)}};c.fn[l]=function(k){return this.each(function(){c.data(this,"plugin_"+l)||c.data(this,"plugin_"+l,new q(this,k))})};c.fn[l].ajaxcall=function(k,l,r,p,q,d,f,b){"undefined"==typeof f?f=!1:null;retVal="";c.ajax({url:k,type:"POST",dataType:"xml/html/script/json/jsonp",async:f,
data:{id:r,name:l,order:p,param:q,pass:d},complete:function(d,k,l){f&&b.set();retVal=c.parseJSON(d.responseText)||d},success:function(b,c,d){},error:function(b,c,d){}});return retVal}})(jQuery,window,document);